<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>oscaar.fitting &mdash; OSCAAR 2.0beta documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="OSCAAR 2.0beta documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">OSCAAR 2.0beta documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for oscaar.fitting</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">import</span> <span class="nn">IO</span>
<span class="kn">import</span> <span class="nn">transitModel</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<div class="viewcode-block" id="fitLinearTrend"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.fitLinearTrend">[docs]</a><span class="k">def</span> <span class="nf">fitLinearTrend</span><span class="p">(</span><span class="n">xVector</span><span class="p">,</span><span class="n">yVector</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Fit a line to the set {xVectorCropped,yVectorCropped}, then remove that linear trend</span>
<span class="sd">	   from the full set {xVector,yVector}&#39;&#39;&#39;</span>
	<span class="k">print</span> <span class="s">&#39;linearTrend&#39;</span>
	<span class="n">initP</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
	<span class="n">fitfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">errfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
	
	<span class="n">bestFitP</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errfunc</span><span class="p">,</span><span class="n">initP</span><span class="p">[:],</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">xVector</span><span class="p">,</span><span class="n">yVector</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">bestFitP</span>
</div>
<div class="viewcode-block" id="linearFunc"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.linearFunc">[docs]</a><span class="k">def</span> <span class="nf">linearFunc</span><span class="p">(</span><span class="n">xVector</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">xVector</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="mcmc"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.mcmc">[docs]</a><span class="k">def</span> <span class="nf">mcmc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">initParams</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">Nsteps</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">saveInterval</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">loadingbar</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Markov Chain Monte Carlo routine for fitting. Takes a set of fluxes `flux` </span>
<span class="sd">	measured at times `t` with uncertainties `sigma`. Input fitting function `func` is fed</span>
<span class="sd">	initial parameters `initParams` and iterated through the chains</span>
<span class="sd">	a total of `Nsteps` times, randomly sampled from normal distributions</span>
<span class="sd">	with widths `beta`, and every `saveInterval`-th state in the chain </span>
<span class="sd">	is saved for later analysis.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	---------- </span>
<span class="sd">	t : list</span>
<span class="sd">		times</span>
<span class="sd">	flux : list</span>
<span class="sd">		fluxes</span>
<span class="sd">	sigma : list</span>
<span class="sd">		uncertainties in fluxes</span>
<span class="sd">	initParams : list</span>
<span class="sd">		initial parameter estimates, `x_0` in Ford 2005</span>
<span class="sd">	func : function</span>
<span class="sd">		fitting function</span>
<span class="sd">	Nsteps : int</span>
<span class="sd">		number of iterations</span>
<span class="sd">	beta : list</span>
<span class="sd">		widths of normal distribution to randomly sample for each parameter</span>
<span class="sd">	saveInterval : int</span>
<span class="sd">		number of steps between &quot;saving&quot; the accepted parameter in the chain.</span>
<span class="sd">		Must satisfy ``Nsteps % saveInterval ==0``.</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	bestp : list</span>
<span class="sd">		parameters at minimum chi^2</span>
<span class="sd">	x_0toN  : array</span>
<span class="sd">		trace of each parameter at each save step</span>
<span class="sd">	acceptanceRate: float</span>
<span class="sd">		the final acceptance rate of the chain</span>
<span class="sd">		</span>
<span class="sd">	Notes</span>
<span class="sd">	-----</span>
<span class="sd">	 * Developed by Brett Morris (NASA-GSFC/UMD)	</span>
<span class="sd">	 * Based on the theory codified by Ford 2005 [1]_</span>
<span class="sd">	 * Code implementation partly influenced by Ian Crossfield&#39;s routines: http://www.mpia-hd.mpg.de/homes/ianc/python/transit.html</span>
<span class="sd">	</span>

<span class="sd">	.. [1] Eric Ford. &quot;Quantifying the Uncertainty in the Orbits of Extrasolar Planets.&quot; </span>
<span class="sd">		   The Astronomical Journal, Volume 129, Issue 3, pp. 1706-1717. 2005.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	
	<span class="n">Nsteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nsteps</span><span class="p">)</span>			<span class="c">## Type cast where necessary</span>
	<span class="n">saveInterval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">saveInterval</span><span class="p">)</span>
	<span class="k">assert</span> <span class="n">Nsteps</span> <span class="o">%</span> <span class="n">saveInterval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Must choose integer number of `saveInterval`s in `Nsteps`. &quot;</span><span class="o">+</span>\
				 <span class="s">&quot;Currently: Nsteps </span><span class="si">%%</span><span class="s"> saveInterval = </span><span class="si">%.2f</span><span class="s"> (should be zero)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Nsteps</span> <span class="o">%</span> <span class="n">saveInterval</span><span class="p">))</span>
	<span class="n">acceptedStates</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">nout</span> <span class="o">=</span> <span class="n">Nsteps</span><span class="o">/</span><span class="n">saveInterval</span>

	<span class="c">## Prepare loading bar plot (if turned on)</span>
	<span class="k">if</span> <span class="n">loadingbar</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
		<span class="n">statusBarFig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
		<span class="n">statusBarFig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s">&#39;Running...&#39;</span><span class="p">)</span>
		<span class="n">statusBarAx</span> <span class="o">=</span> <span class="n">statusBarFig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
		<span class="n">statusBarAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Markov Chain Monte Carlo fitting...&#39;</span><span class="p">)</span>
		<span class="n">statusBarAx</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
		<span class="n">statusBarAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Percent Complete (%)&#39;</span><span class="p">)</span>
		<span class="n">statusBarAx</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
	
	<span class="c">## Metropolis-Hastings algorithm...</span>
	<span class="n">x_n</span> <span class="o">=</span> <span class="n">initParams</span> <span class="c">## initial trial state, **Step 1 in Ford 2005**, n=0</span>
	<span class="n">weights</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span>
	<span class="n">x_0toN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x_n</span><span class="p">),</span><span class="n">nout</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
	<span class="n">allchi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
	<span class="n">bestp</span> <span class="o">=</span> <span class="bp">None</span>
	
	<span class="c">## Compute chi^2 using initial params</span>
	<span class="n">trialModel</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x_n</span><span class="p">)</span>
	<span class="n">chisq_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">trialModel</span><span class="o">-</span><span class="n">flux</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">weights</span><span class="p">)</span>
	<span class="n">chisq_min</span> <span class="o">=</span> <span class="mf">1e100</span>	<span class="c">## Set very high initial chi-squared that will get immediately overwritten</span>
	<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nsteps</span><span class="p">):</span>
		<span class="c">## Update the loading bar every so often</span>
		<span class="k">if</span> <span class="n">loadingbar</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">5000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
			<span class="n">statusBarAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Markov Chain Monte Carlo fitting...&#39;</span><span class="p">)</span>
			<span class="n">statusBarAx</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
			<span class="n">statusBarAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Percent Complete (%)&#39;</span><span class="p">)</span>
			<span class="n">statusBarAx</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
			<span class="n">statusBarAx</span><span class="o">.</span><span class="n">barh</span><span class="p">([</span><span class="mi">0</span><span class="p">],[</span><span class="mf">100.0</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">Nsteps</span><span class="p">],[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
		<span class="c">## Generate trial step in parameters, **Step 2 in Ford 2005**</span>
		<span class="n">x_nplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span>	 
			<span class="c">## ^^^ Sample gaussians with widths `beta` randomly centered </span>
			<span class="c">##		about each parameter in `params`</span>
			
		<span class="c">## Should hold fixed constants and ensure pos-def here (not implementing)</span>
		<span class="n">trialModel</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x_nplus1</span><span class="p">)</span>
		
		<span class="c">## Calculate chisq for current step **Step 3 in Ford 2005**</span>
		<span class="n">chisq_nplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">trialModel</span><span class="o">-</span><span class="n">flux</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">weights</span><span class="p">)</span>	
		
		<span class="c">## Ratio of probability distributions, Eq. 9 of Ford 2005;  **Step 4 in Ford 2005**</span>
		<span class="n">ratioOfProbDist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">chisq_n</span> <span class="o">-</span> <span class="n">chisq_nplus1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>	
		<span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ratioOfProbDist</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="c">## Eq. 11 in Ford 2005</span>
		
		<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>		<span class="c">## Draw random number on (0,1), **Step 5 in Ford 2005**</span>
		<span class="k">if</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="n">alpha</span><span class="p">:</span>					<span class="c">## If u&lt;=alpha, accept this state</span>
			<span class="n">x_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_nplus1</span><span class="p">)</span>
			<span class="n">chisq_n</span> <span class="o">=</span> <span class="n">chisq_nplus1</span>
			<span class="n">acceptedStates</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="c">#elif u &gt; alpha: x_nplus1 = x_n	## Implicit, commented out</span>
		
		<span class="k">if</span> <span class="n">chisq_nplus1</span> <span class="o">&lt;</span> <span class="n">chisq_min</span><span class="p">:</span>	<span class="c">## If this chisq is minimum, record it</span>
			<span class="n">bestp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
			<span class="n">chisq_min</span> <span class="o">=</span> <span class="n">chisq_n</span>
			
		<span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">saveInterval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>		 <span class="c">## Every `saveInterval`-th state, save it</span>
			<span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&quot;Step&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s">&quot;of&quot;</span><span class="p">,</span><span class="n">Nsteps</span>
			<span class="n">x_0toN</span><span class="p">[:,</span><span class="n">n</span><span class="o">/</span><span class="n">saveInterval</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
			<span class="n">allchi</span><span class="p">[</span><span class="n">n</span><span class="o">/</span><span class="n">saveInterval</span><span class="p">]</span> <span class="o">=</span> <span class="n">chisq_n</span>

	<span class="c">## Calculate acceptance rate, should ideally be ~0.44 (Ford 2005)</span>
	<span class="n">acceptanceRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">acceptedStates</span><span class="p">)</span><span class="o">/</span><span class="n">Nsteps</span>	
	<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">assert</span> <span class="n">bestp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;No best-fit found, chi^2 minimizing state not found&quot;</span>
	<span class="k">return</span> <span class="n">bestp</span><span class="p">,</span> <span class="n">x_0toN</span><span class="p">,</span> <span class="n">acceptanceRate</span>
</div>
<div class="viewcode-block" id="mcmc_iterate"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.mcmc_iterate">[docs]</a><span class="k">def</span> <span class="nf">mcmc_iterate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">initParams</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">Nsteps</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">saveInterval</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
 	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	   MCMC routine specifically for optimizing the beta parameters with the </span>
<span class="sd">	   optimizeBeta() function. </span>
<span class="sd"> </span>
<span class="sd"> 	   Parameters</span>
<span class="sd">	   ---------- </span>
<span class="sd">		t : list</span>
<span class="sd">			time</span>
<span class="sd">		flux : list</span>
<span class="sd">			fluxes</span>
<span class="sd">		sigma : list</span>
<span class="sd">			uncertainties in fluxes</span>
<span class="sd">		initParams : list </span>
<span class="sd">			initial parameter estimates, `x_0` in Ford 2005</span>
<span class="sd">		func : function </span>
<span class="sd">			fitting function</span>
<span class="sd">		Nsteps : int</span>
<span class="sd">			number of steps to try in the chains</span>
<span class="sd">		beta : list</span>
<span class="sd">			widths of normal distribution to randomly sample for each parameter</span>
<span class="sd">	</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		acceptanceRateArray : list </span>
<span class="sd">			Acceptance rates for each beta_mu   </span>
<span class="sd">		</span>
<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		 * Developed by Brett Morris (NASA-GSFC/UMD)	</span>
<span class="sd">		 * Based on the theory codified by Ford (2005) [1]</span>
<span class="sd">		 * Code implementation partly influenced by Ian Crossfield&#39;s routines: http://www.mpia-hd.mpg.de/homes/ianc/python/transit.html </span>

<span class="sd">		.. [1] Eric Ford. &quot;Quantifying the Uncertainty in the Orbits of Extrasolar Planets.&quot; </span>
<span class="sd">			   The Astronomical Journal, Volume 129, Issue 3, pp. 1706-1717. 2005.</span>
<span class="sd">	&quot;&quot;&quot;</span>   
	
	<span class="n">bestp</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="n">timeout_counter</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">while</span> <span class="n">bestp</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">timeout_counter</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">assert</span> <span class="n">timeout_counter</span> <span class="o">&lt;</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s">&quot;mcmc_iterate time out: Your initial parameters are likely very poor,&quot;</span><span class="o">+</span>\
					<span class="s">&quot;and the MCMC script can&#39;t find a best-fit solution starting from them. Try better initial parameters.&quot;</span>
		<span class="n">Niterations</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">initParams</span><span class="p">)</span><span class="c">#20 ##40000	## Hard coded in Evan&#39;s code as 4e4</span>

		
		<span class="c">## Change one of the initial parameters at random per each iteration</span>
		<span class="n">randomInitParamIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">initParams</span><span class="p">),</span><span class="n">Niterations</span><span class="p">))</span>	<span class="c">## array of random indices of initParams</span>
		<span class="n">NacceptancesPerParameter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initParams</span><span class="p">))</span>	<span class="c">## initialize arrays</span>
		<span class="n">NstepsPerParameter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initParams</span><span class="p">))</span>
		<span class="n">originalInitParams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">initParams</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Niterations</span><span class="p">):</span>
			<span class="n">initParams</span> <span class="o">=</span> <span class="n">originalInitParams</span>
			<span class="c">#print &quot;Iteration&quot;,i,&quot;of&quot;,Niterations</span>
			<span class="n">testParamIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">randomInitParamIndex</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>	<span class="c">## This initParam index will be tested</span>
			<span class="c">## Only use physically valid parameters, for this example, make up validity rules:</span>
			<span class="c">## Keep slope between -0.2&lt;m&lt;0.2 and int between 0.0&lt;intercept&lt;1.0</span>
			<span class="n">continueTag</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="c">#while initParams[0] &gt; 0.2 or initParams[0] &lt; -0.2 or initParams[1] &gt; 1.0 or initParams[1] &lt; 0.0 or continueTag:</span>
			<span class="c">#	initParams[testParamIndex] += np.random.normal(0,1)*beta[testParamIndex]			## np.random.normal(0,1) is equivalent to the IDL: randomn(seed,1)</span>
			<span class="c">#	continueTag = False</span>
			<span class="n">initParams</span><span class="p">[</span><span class="n">testParamIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">beta</span><span class="p">[</span><span class="n">testParamIndex</span><span class="p">]</span>
			
			<span class="n">Nsteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nsteps</span><span class="p">)</span>			<span class="c">## Type cast where necessary</span>
			<span class="n">saveInterval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">saveInterval</span><span class="p">)</span>
			<span class="k">assert</span> <span class="n">Nsteps</span> <span class="o">%</span> <span class="n">saveInterval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Must choose integer number of `saveInterval`s in `Nsteps`. &quot;</span><span class="o">+</span>\
						 <span class="s">&quot;Currently: Nsteps </span><span class="si">%%</span><span class="s"> saveInterval = </span><span class="si">%.2f</span><span class="s"> (should be zero)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Nsteps</span> <span class="o">%</span> <span class="n">saveInterval</span><span class="p">))</span>
			<span class="n">acceptedStates</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">nout</span> <span class="o">=</span> <span class="n">Nsteps</span><span class="o">/</span><span class="n">saveInterval</span>
			
			<span class="c">## Metropolis-Hastings algorithm...</span>
			<span class="n">x_n</span> <span class="o">=</span> <span class="n">initParams</span> <span class="c">## initial trial state, **Step 1 in Ford 2005**, n=0</span>
			<span class="n">weights</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span>
			<span class="n">x_0toN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x_n</span><span class="p">),</span><span class="n">nout</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
			<span class="n">allchi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
			<span class="n">bestp</span> <span class="o">=</span> <span class="bp">None</span>
			
			<span class="c">## Compute chi^2 using initial params</span>
			<span class="n">trialModel</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x_n</span><span class="p">)</span>
			<span class="n">chisq_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">trialModel</span><span class="o">-</span><span class="n">flux</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">weights</span><span class="p">)</span>
			<span class="n">chisq_min</span> <span class="o">=</span> <span class="mf">1e100</span>	<span class="c">## Set very high initial chi-squared that will get immediately overwritten</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nsteps</span><span class="p">):</span>
				<span class="c">## Generate trial step in parameters, **Step 2 in Ford 2005**</span>
				<span class="n">x_nplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span>	 
					<span class="c">## ^^^ Sample gaussians with widths `beta` randomly centered </span>
					<span class="c">##		about each parameter in `params`</span>
					
				<span class="c">## Should hold fixed constants and ensure pos-def here (not implementing)</span>
				<span class="n">trialModel</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x_nplus1</span><span class="p">)</span>
				
				<span class="c">## Calculate chisq for current step **Step 3 in Ford 2005**</span>
				<span class="n">chisq_nplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">trialModel</span><span class="o">-</span><span class="n">flux</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">weights</span><span class="p">)</span>	
				
				<span class="c">## Ratio of probability distributions, Eq. 9 of Ford 2005;  **Step 4 in Ford 2005**</span>
				<span class="n">ratioOfProbDist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">chisq_n</span> <span class="o">-</span> <span class="n">chisq_nplus1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>	
				<span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ratioOfProbDist</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="c">## Eq. 11 in Ford 2005</span>
				
				<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>		<span class="c">## Draw random number on (0,1), **Step 5 in Ford 2005**</span>
				<span class="k">if</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="n">alpha</span><span class="p">:</span>					<span class="c">## If u&lt;=alpha, accept this state</span>
					<span class="n">x_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_nplus1</span><span class="p">)</span>
					<span class="n">chisq_n</span> <span class="o">=</span> <span class="n">chisq_nplus1</span>
					<span class="n">acceptedStates</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="n">NacceptancesPerParameter</span><span class="p">[</span><span class="n">testParamIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="n">NstepsPerParameter</span><span class="p">[</span><span class="n">testParamIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="c">#elif u &gt; alpha: x_nplus1 = x_n	## Implicit, commented out</span>
				
				<span class="k">if</span> <span class="n">chisq_nplus1</span> <span class="o">&lt;</span> <span class="n">chisq_min</span><span class="p">:</span>	<span class="c">## If this chisq is minimum, record it</span>
					<span class="n">bestp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
					<span class="n">chisq_min</span> <span class="o">=</span> <span class="n">chisq_n</span>
					
				<span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">saveInterval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>		 <span class="c">## Every `saveInterval`-th state, save it</span>
					<span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&quot;Step&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s">&quot;of&quot;</span><span class="p">,</span><span class="n">Nsteps</span>
					<span class="n">x_0toN</span><span class="p">[:,</span><span class="n">n</span><span class="o">/</span><span class="n">saveInterval</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
					<span class="n">allchi</span><span class="p">[</span><span class="n">n</span><span class="o">/</span><span class="n">saveInterval</span><span class="p">]</span> <span class="o">=</span> <span class="n">chisq_n</span>
		
			<span class="c">## Calculate acceptance rate, should ideally be ~0.44 (Ford 2005)</span>
			<span class="n">acceptanceRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">acceptedStates</span><span class="p">)</span><span class="o">/</span><span class="n">Nsteps</span>	
		
			<span class="c">#assert bestp is not None, &quot;No best-fit found, chi^2 minimizing state not found&quot;</span>
			<span class="c">#return bestp, x_0toN, acceptanceRate</span>
		<span class="n">acceptanceRateArray</span> <span class="o">=</span> <span class="n">NacceptancesPerParameter</span><span class="o">/</span><span class="n">NstepsPerParameter</span> 
	
	<span class="k">return</span> <span class="n">acceptanceRateArray</span>

</div>
<div class="viewcode-block" id="optimizeBeta"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.optimizeBeta">[docs]</a><span class="k">def</span> <span class="nf">optimizeBeta</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">initParams</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">idealAcceptanceRate</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	The `beta` input parameters for the MCMC function determine the </span>
<span class="sd">	acceptance rate of the Metropolis-Hastings algorithm. According</span>
<span class="sd">	to Ford 2005, the ideal acceptance rate is ~0.25 - ~0.44. This routine</span>
<span class="sd">	is designed to take an initial guess for each of the beta parameters</span>
<span class="sd">	and tweak them until they produce good acceptance rates for each parameter.</span>
<span class="sd">	This is achieved by randomly perturbing each initial parameter with the small</span>
<span class="sd">	perturbation by randomly sampling a normal distribution with a width given by</span>
<span class="sd">	the initial beta vector `beta`. optimizeBeta() then tries running an MCMC chain</span>
<span class="sd">	briefly to find the acceptance rate for that beta parameter. If the acceptance</span>
<span class="sd">	rates are two high, for example, then the beta is too low, and optimizeBeta() </span>
<span class="sd">	will increase beta. This process continues until the beta vector produces</span>
<span class="sd">	acceptance rates within 10% of the `idealAcceptanceRate`, which according to</span>
<span class="sd">	Ford (2005) should be between 0.25-0.44.</span>

<span class="sd">	Parameters</span>
<span class="sd">	---------- </span>
<span class="sd">	t : list</span>
<span class="sd">		time</span>
<span class="sd">	flux : list</span>
<span class="sd">		fluxes</span>
<span class="sd">	sigma : list</span>
<span class="sd">		uncertainties in fluxes</span>
<span class="sd">	initParams : list </span>
<span class="sd">		initial parameter estimates, `x_0` in Ford 2005</span>
<span class="sd">	func : function </span>
<span class="sd">		fitting function</span>
<span class="sd">	beta : list</span>
<span class="sd">		widths of normal distribution to randomly sample for each parameter</span>
<span class="sd">	idealAcceptanceRate : float</span>
<span class="sd">		desired acceptance rate to be produced by the optimized `beta`</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	beta : list</span>
<span class="sd">		the beta vector optimized so that running a MCMC chain should produce</span>
<span class="sd">		acceptance rates near `idealAcceptanceRate` (vector)</span>

<span class="sd">	Notes</span>
<span class="sd">	-----</span>
<span class="sd">	 * Developed by Brett Morris (NASA-GSFC/UMD)	</span>
<span class="sd">	 * Based on the theory codified by Ford (2005) [1]_</span>
<span class="sd">	 * Code implementation partly influenced by Evan Sinukoff&#39;s MCMC_Evan_Master_v3_new22.pro</span>


<span class="sd">	.. [1] Eric Ford. &quot;Quantifying the Uncertainty in the Orbits of Extrasolar Planets.&quot; </span>
<span class="sd">		   The Astronomical Journal, Volume 129, Issue 3, pp. 1706-1717. 2005.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="n">Nsteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initParams</span><span class="p">)</span><span class="o">*</span><span class="mf">100.0</span>	  <span class="c">## do N iterations per parameter</span>
	<span class="n">saveInterval</span> <span class="o">=</span> <span class="mf">10.0</span>					<span class="c">## Save every Nth step</span>
	<span class="n">acceptanceRateArray</span> <span class="o">=</span> <span class="n">mcmc_iterate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">initParams</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">Nsteps</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">saveInterval</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s">&#39;Beta optimization...&#39;</span><span class="p">)</span>
		<span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
		<span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Optimizing the set of $</span><span class="se">\\</span><span class="s">beta_\mu$...&quot;</span><span class="p">)</span>
		<span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Optimization iteration&quot;</span><span class="p">)</span>
		<span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;Acceptance Rate&quot;</span><span class="p">)</span>
		<span class="n">axis</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
		<span class="n">axis</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.9</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>		

	<span class="k">for</span> <span class="n">paramIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">initParams</span><span class="p">)):</span>	<span class="c">## For each random parameter to be changed,</span>
		<span class="n">iterationCounter</span> <span class="o">=</span> <span class="mi">0</span>		<span class="c">## Count how many times the while loop has been run</span>
		<span class="k">while</span> <span class="nb">any</span><span class="p">(</span><span class="n">acceptanceRateArray</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">acceptanceRateArray</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">):</span>	<span class="c">## While the acceptance rate is unacceptable (Ford 2005), </span>
			<span class="k">assert</span> <span class="n">iterationCounter</span><span class="o">&lt;</span><span class="mf">1e2</span><span class="p">,</span><span class="s">&quot;After 100 trials, the input beta parameters were not successfully optimized. Try new initial beta values.&quot;</span>

			<span class="c">## Calculate the acceptance rates for each individual beta parameter</span>
			<span class="n">acceptanceRateArray</span> <span class="o">=</span> <span class="n">mcmc_iterate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">initParams</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">Nsteps</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">saveInterval</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

			<span class="c">## If the acceptance rate is too high, the normal distributions sampled about each input parameter</span>
			<span class="c">## are not wide enough, so try increasing the beta_mu term by raising (acceptanceRate/idealAcceptanceRate)</span>
			<span class="c">## to a positive power `phi`, so that betaFactor = (acceptanceRate/idealAcceptanceRate)^phi &gt; 1 and therefore</span>
			<span class="c">## beta_mu * betaFactor &gt; beta_mu, i.e., the next beta_mu will be larger.</span>
			<span class="c">## If the acceptance rate is too low, take betaFactor &lt; 1, and if the acceptance rate is good, take</span>
			<span class="c">## phi to be zero, i.e., betaFactor = 1.0, or &quot;make no change in beta_mu on this step&quot;</span>
			<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acceptanceRateArray</span><span class="p">))</span> <span class="c">## Initialize `phi` array</span>
			
			<span class="n">phi</span><span class="p">[</span><span class="n">acceptanceRateArray</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>	
			<span class="n">phi</span><span class="p">[</span><span class="n">acceptanceRateArray</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="c">#phi[acceptanceRateArray &gt; 1.4*idealAcceptanceRate] = 3			## If very far from within the limits, use higher power</span>
			<span class="c">#phi[acceptanceRateArray &lt; 0.6*idealAcceptanceRate] = 3			</span>
			<span class="n">phi</span><span class="p">[(</span><span class="n">acceptanceRateArray</span> <span class="o">&lt;=</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">acceptanceRateArray</span> <span class="o">&gt;=</span> <span class="mf">0.9</span><span class="o">*</span><span class="n">idealAcceptanceRate</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">betaFactor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">acceptanceRateArray</span><span class="o">/</span><span class="n">idealAcceptanceRate</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span> <span class="c">## Change beta by a factor of `betaFactor</span>
			<span class="n">betaFactor</span><span class="p">[</span><span class="n">betaFactor</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>		<span class="c">## If betaFactor very small, limit it to 1/100</span>
			<span class="k">print</span> <span class="s">&quot;Betas:&quot;</span><span class="p">,</span> <span class="n">beta</span>
			<span class="n">beta</span> <span class="o">*=</span> <span class="n">betaFactor</span>
			<span class="k">print</span> <span class="s">&quot;Optimizing each Beta_mu: acceptance rates for each parameter:&quot;</span><span class="p">,</span> <span class="n">acceptanceRateArray</span>
			<span class="k">print</span> <span class="s">&quot;Optimize by multiplying current beta by:&quot;</span><span class="p">,</span><span class="n">betaFactor</span>
			<span class="n">iterationCounter</span> <span class="o">+=</span> <span class="mi">1</span>

			<span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
				<span class="k">for</span> <span class="n">acceptanceRate</span> <span class="ow">in</span> <span class="n">acceptanceRateArray</span><span class="p">:</span>
					<span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iterationCounter</span><span class="p">,</span><span class="n">acceptanceRate</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">markeredgecolor</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">iterationCounter</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
		<span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>	<span class="c">## Pause for a second so the user can see that the solution has been reached</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">beta</span>
</div>
<div class="viewcode-block" id="get_uncertainties"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.get_uncertainties">[docs]</a><span class="k">def</span> <span class="nf">get_uncertainties</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">bestFitParameter</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Find the uncertainties from a MCMC parameter chain. </span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	param : list</span>
<span class="sd">		parameter chain from the completed MCMC algorithm</span>
<span class="sd">	</span>
<span class="sd">	bestFitParam : float</span>
<span class="sd">		the best-fit (chi-squared) minimizing value for the</span>
<span class="sd">		parameter chain</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	[plus,minus] : list of floats</span>
<span class="sd">		the upper and lower 1-sigma uncertainties on the best fit</span>
<span class="sd">		parameter `bestFitParameter`</span>
<span class="sd">	</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">lowerHalf</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">param</span> <span class="o">&lt;</span> <span class="n">bestFitParameter</span><span class="p">]</span>
	<span class="n">upperHalf</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">param</span> <span class="o">&gt;</span> <span class="n">bestFitParameter</span><span class="p">]</span>
	
	<span class="n">plus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">upperHalf</span> <span class="o">-</span> <span class="n">bestFitParameter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">upperHalf</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">minus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lowerHalf</span> <span class="o">-</span> <span class="n">bestFitParameter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lowerHalf</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">plus</span><span class="p">,</span><span class="n">minus</span><span class="p">]</span>

<span class="c"># def histplot(parameter,axis,title,bestFitParameter):</span>
<span class="c"># 	&quot;&quot;&quot;</span>
<span class="c"># 	Plot a histogram with 50 bins displaying the parameter chain</span>
<span class="c"># 	frequencies for the chain `parameter` with best fit value</span>
<span class="c"># 	`bestFitParameter`. Name the figure after the parameter `title`</span>
<span class="c"># 	and plot it to the axis `axis`. </span>
<span class="c"># 	</span>
<span class="c"># 	&quot;&quot;&quot;</span>
<span class="c"># 	postburn = parameter[burnFraction*len(parameter):len(parameter)]	## Burn beginning of chain</span>
<span class="c"># 	Nbins = 50			  ## Plot histograms with 15 bins</span>
<span class="c"># 	n, bins, patches = axis.hist(postburn, Nbins, normed=0, facecolor=&#39;white&#39;,histtype=&#39;stepfilled&#39;)  ## Generate histogram</span>
<span class="c"># 	plus,minus = get_uncertainties(postburn,bestFitParameter)   ## Calculate uncertainties on best fit parameter</span>
<span class="c"># 	axis.axvline(ymin=0,ymax=1,x=bestFitParameter+plus,ls=&#39;:&#39;,color=&#39;r&#39;)	## Plot vertical lines representing uncertainties</span>
<span class="c"># 	axis.axvline(ymin=0,ymax=1,x=bestFitParameter-minus,ls=&#39;:&#39;,color=&#39;r&#39;)</span>
<span class="c"># 	axis.set_ylim([0,np.max(n)])		</span>
<span class="c"># 	axis.set_title(title)</span>
</div>
<div class="viewcode-block" id="updatePKL"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.updatePKL">[docs]</a><span class="k">def</span> <span class="nf">updatePKL</span><span class="p">(</span><span class="n">bestp</span><span class="p">,</span><span class="n">allparams</span><span class="p">,</span><span class="n">acceptanceRate</span><span class="p">,</span><span class="n">pklPath</span><span class="p">,</span><span class="n">uncertainties</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Load an OSCAAR pkl, add the MCMC parameters to the file, save it again. </span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	bestp : list</span>
<span class="sd">		best-fit values for each parameter</span>
<span class="sd">		</span>
<span class="sd">	allparams : array</span>
<span class="sd">		2D array where each saved state of the chains is stored along one dimension,</span>
<span class="sd">		for each fitting parameter (along the other)</span>
<span class="sd">		</span>
<span class="sd">	acceptanceRate : float</span>
<span class="sd">		the final acceptance rate acheived in the chain</span>
<span class="sd">		</span>
<span class="sd">	pklPath : str</span>
<span class="sd">		path to the pkl to overwrite.</span>
<span class="sd">	</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pklPath</span><span class="p">)</span>
	<span class="n">data</span><span class="o">.</span><span class="n">updateMCMC</span><span class="p">(</span><span class="n">bestp</span><span class="p">,</span><span class="n">allparams</span><span class="p">,</span><span class="n">acceptanceRate</span><span class="p">,</span><span class="n">pklPath</span><span class="p">,</span><span class="n">uncertainties</span><span class="p">)</span>
	<span class="n">IO</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pklPath</span><span class="p">)</span>
	</div>
<div class="viewcode-block" id="mcmcfit"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.mcmcfit">[docs]</a><span class="k">class</span> <span class="nc">mcmcfit</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataBankPath</span><span class="p">,</span><span class="n">initParams</span><span class="p">,</span><span class="n">initBeta</span><span class="p">,</span><span class="n">Nsteps</span><span class="p">,</span><span class="n">saveInterval</span><span class="p">,</span><span class="n">idealAcceptanceRate</span><span class="p">,</span><span class="n">burnFraction</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Initialize the `mcmc` object with the initial parameters and data needed</span>
<span class="sd">		to prepare the MCMC run. </span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		dataBankPath : string</span>
<span class="sd">			Path to a saved instance of the dataBank object from </span>
<span class="sd">			`oscaar.save` which we&#39;ll use to extract the times, </span>
<span class="sd">			fluxes and uncertainties in the light curve (string).</span>
<span class="sd">								</span>
<span class="sd">		initParams : list</span>
<span class="sd">			Initial parameter estimates, `x_0` in Ford 2005. Should be in </span>
<span class="sd">			the following order: RpOverRs,aOverRs,per,inc,gamma1,gamma2,ecc,longPericenter,t0</span>
<span class="sd">									</span>
<span class="sd">		Nsteps : int</span>
<span class="sd">			number of steps/links in the MCMC chain</span>
<span class="sd">		</span>
<span class="sd">		initBeta : list</span>
<span class="sd">			widths of normal distribution to randomly sample for each parameter</span>
<span class="sd">								</span>
<span class="sd">		saveInterval : int</span>
<span class="sd">			number of steps between &quot;saves&quot;, ie, storing</span>
<span class="sd">			the current step for later analysis</span>
<span class="sd">								</span>
<span class="sd">		idealAcceptanceRate : float</span>
<span class="sd">			ideal acceptance rate that you would like the chain to </span>
<span class="sd">			have, definied by Ford 2005. Ideally ~0.25-0.44.</span>
<span class="sd">								</span>
<span class="sd">		burnFraction : float </span>
<span class="sd">			fraction of saved steps at the beginning of the chains </span>
<span class="sd">			to discard when computing uncertainties. Typically ~0.20</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="c">## Load parameters</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dataBankPath</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">dataBankPath</span> <span class="o">=</span> <span class="n">dataBankPath</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">initParams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">initParams</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Nsteps</span> <span class="o">=</span> <span class="n">Nsteps</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">initBeta</span> <span class="o">=</span> <span class="n">initBeta</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">idealAcceptanceRate</span> <span class="o">=</span> <span class="n">idealAcceptanceRate</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">saveInterval</span> <span class="o">=</span> <span class="n">saveInterval</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">burnFraction</span> <span class="o">=</span> <span class="n">burnFraction</span>
		<span class="c">## Choose the implementation of transit light curve function to use:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">transitModel</span><span class="o">.</span><span class="n">occultquad</span>  
	
<div class="viewcode-block" id="mcmcfit.run"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.mcmcfit.run">[docs]</a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">updatepkl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">apertureRadiusIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Run the MCMC algorithms: </span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		updatepkl : bool, optional</span>
<span class="sd">			update the OSCAAR save pkl file from which the data had</span>
<span class="sd">			been loaded with the MCMC best fit parameters, parameter</span>
<span class="sd">			chains, and acceptance rate. </span>
<span class="sd">		</span>
<span class="sd">		apertureRadiusIndex : int, optional</span>
<span class="sd">			Integer index of the aperture radius for which you&#39;d like</span>
<span class="sd">			to compute the MCMC fit, from the aperture </span>
<span class="sd">			radius range list</span>
<span class="sd">		&#39;&#39;&#39;</span>

		<span class="k">def</span> <span class="nf">occult4params</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">freeparams</span><span class="p">,</span><span class="n">allparams</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initParams</span><span class="p">):</span>
			<span class="sd">&#39;&#39;&#39;Allow 4 parameters to vary freely, keep the others fixed at the values assigned below&#39;&#39;&#39;</span>
			<span class="n">RpOverRs_free</span><span class="p">,</span><span class="n">aOverRs_free</span><span class="p">,</span><span class="n">inc_free</span><span class="p">,</span><span class="n">t0_free</span> <span class="o">=</span> <span class="n">freeparams</span>
			<span class="n">RpOverRs</span><span class="p">,</span><span class="n">aOverRs</span><span class="p">,</span><span class="n">per</span><span class="p">,</span><span class="n">inc</span><span class="p">,</span><span class="n">gamma1</span><span class="p">,</span><span class="n">gamma2</span><span class="p">,</span><span class="n">ecc</span><span class="p">,</span><span class="n">longPericenter</span><span class="p">,</span><span class="n">t0</span> <span class="o">=</span> <span class="n">allparams</span>
			<span class="k">return</span> <span class="n">transitModel</span><span class="o">.</span><span class="n">occultquad</span><span class="p">(</span><span class="n">t</span><span class="p">,[</span><span class="n">RpOverRs_free</span><span class="p">,</span><span class="n">aOverRs_free</span><span class="p">,</span><span class="n">per</span><span class="p">,</span><span class="n">inc_free</span><span class="p">,</span><span class="n">gamma1</span><span class="p">,</span><span class="n">gamma2</span><span class="p">,</span><span class="n">ecc</span><span class="p">,</span><span class="n">longPericenter</span><span class="p">,</span><span class="n">t0_free</span><span class="p">])</span>

		<span class="n">RpOverRs</span><span class="p">,</span><span class="n">aOverRs</span><span class="p">,</span><span class="n">per</span><span class="p">,</span><span class="n">inc</span><span class="p">,</span><span class="n">gamma1</span><span class="p">,</span><span class="n">gamma2</span><span class="p">,</span><span class="n">ecc</span><span class="p">,</span><span class="n">longPericenter</span><span class="p">,</span><span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initParams</span>
		<span class="n">initParams</span> <span class="o">=</span> <span class="p">[</span><span class="n">RpOverRs</span><span class="p">,</span><span class="n">aOverRs</span><span class="p">,</span><span class="n">inc</span><span class="p">,</span><span class="n">t0</span><span class="p">]</span>
		<span class="n">beta</span> <span class="o">=</span> <span class="n">optimizeBeta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">times</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lightCurves</span><span class="p">[</span><span class="n">apertureRadiusIndex</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lightCurveErrors</span><span class="p">[</span><span class="n">apertureRadiusIndex</span><span class="p">],</span>\
											<span class="n">initParams</span><span class="p">,</span><span class="n">occult4params</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initBeta</span><span class="p">,</span><span class="n">idealAcceptanceRate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idealAcceptanceRate</span><span class="p">)</span>


		<span class="bp">self</span><span class="o">.</span><span class="n">bestp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allparams</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptanceRate</span> <span class="o">=</span> <span class="n">mcmc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">times</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lightCurves</span><span class="p">[</span><span class="n">apertureRadiusIndex</span><span class="p">],</span>\
									<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lightCurveErrors</span><span class="p">[</span><span class="n">apertureRadiusIndex</span><span class="p">],</span><span class="n">initParams</span><span class="p">,</span><span class="n">occult4params</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsteps</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span>\
									<span class="bp">self</span><span class="o">.</span><span class="n">saveInterval</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">loadingbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">MCMCuncertainties</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allparams</span><span class="p">)):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">MCMCuncertainties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allparams</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">bestp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
		
		<span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">allparams</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptanceRate</span>
		<span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">MCMCuncertainties</span>
		<span class="k">if</span> <span class="n">updatepkl</span><span class="p">:</span> <span class="n">updatePKL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bestp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">allparams</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptanceRate</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dataBankPath</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">MCMCuncertainties</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="mcmcfit.plot"><a class="viewcode-back" href="../../oscaar.html#oscaar.fitting.mcmcfit.plot">[docs]</a>	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
		<span class="k">def</span> <span class="nf">occult4params</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">freeparams</span><span class="p">,</span><span class="n">allparams</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initParams</span><span class="p">):</span>
			<span class="sd">&#39;&#39;&#39;Allow 4 parameters to vary freely, keep the others fixed at the values assigned below&#39;&#39;&#39;</span>
			<span class="n">RpOverRs_free</span><span class="p">,</span><span class="n">aOverRs_free</span><span class="p">,</span><span class="n">inc_free</span><span class="p">,</span><span class="n">t0_free</span> <span class="o">=</span> <span class="n">freeparams</span>
			<span class="n">RpOverRs</span><span class="p">,</span><span class="n">aOverRs</span><span class="p">,</span><span class="n">per</span><span class="p">,</span><span class="n">inc</span><span class="p">,</span><span class="n">gamma1</span><span class="p">,</span><span class="n">gamma2</span><span class="p">,</span><span class="n">ecc</span><span class="p">,</span><span class="n">longPericenter</span><span class="p">,</span><span class="n">t0</span> <span class="o">=</span> <span class="n">allparams</span>
			<span class="k">return</span> <span class="n">transitModel</span><span class="o">.</span><span class="n">occultquad</span><span class="p">(</span><span class="n">t</span><span class="p">,[</span><span class="n">RpOverRs_free</span><span class="p">,</span><span class="n">aOverRs_free</span><span class="p">,</span><span class="n">per</span><span class="p">,</span><span class="n">inc_free</span><span class="p">,</span><span class="n">gamma1</span><span class="p">,</span><span class="n">gamma2</span><span class="p">,</span><span class="n">ecc</span><span class="p">,</span><span class="n">longPericenter</span><span class="p">,</span><span class="n">t0_free</span><span class="p">])</span>

		<span class="n">bestp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestp</span>
		<span class="n">allparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allparams</span>
		<span class="n">acceptanceRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptanceRate</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataBankPath</span><span class="p">)</span>
		<span class="n">burnFraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">burnFraction</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">times</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lightCurves</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
		<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lightCurveErrors</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
	
		<span class="c">##############################</span>
		<span class="c"># Prepare figures</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>		
		<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s">&#39;MCMC Results: Chains&#39;</span><span class="p">)</span> 

		<span class="n">figLC</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
		<span class="n">figLC</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s">&#39;MCMC Results: Light Curve&#39;</span><span class="p">)</span> 

		<span class="n">LCax1</span> <span class="o">=</span> <span class="n">figLC</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
		<span class="n">LCax2</span> <span class="o">=</span> <span class="n">figLC</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="n">LCax1</span><span class="p">)</span>
		<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">421</span><span class="p">)</span>
		<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">422</span><span class="p">)</span>
		<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">423</span><span class="p">)</span>
		<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">424</span><span class="p">)</span>
		<span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">425</span><span class="p">)</span>
		<span class="n">ax6</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">426</span><span class="p">)</span>
		<span class="n">ax7</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">427</span><span class="p">)</span>
		<span class="n">ax8</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">428</span><span class="p">)</span>

		<span class="n">yfit</span> <span class="o">=</span> <span class="n">occult4params</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">bestp</span><span class="p">)</span>
		<span class="n">LCax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
		<span class="n">LCax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yfit</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
		<span class="n">LCax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Fit with MCMC&quot;</span><span class="p">)</span>
		<span class="n">LCax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Time (JD)&quot;</span><span class="p">)</span>
		<span class="n">LCax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;Relative Flux&quot;</span><span class="p">)</span>
		<span class="k">def</span> <span class="nf">format_coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
			<span class="c"># &#39;&#39;&#39;Function to give data value on mouse over plot.&#39;&#39;&#39;</span>
			<span class="k">return</span> <span class="s">&quot;Time (JD): </span><span class="si">%.6f</span><span class="s">, Flux: </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
		<span class="n">LCax1</span><span class="o">.</span><span class="n">format_coord</span> <span class="o">=</span> <span class="n">format_coord</span>
		
		<span class="n">LCax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">yfit</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
		<span class="n">LCax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">)</span>
		<span class="n">LCax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Fit Residuals&quot;</span><span class="p">)</span>
		<span class="n">LCax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Time (JD)&quot;</span><span class="p">)</span>
		<span class="n">LCax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;Relative Flux&quot;</span><span class="p">)</span>
		<span class="k">def</span> <span class="nf">format_coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
			<span class="c"># &#39;&#39;&#39;Function to give data value on mouse over plot.&#39;&#39;&#39;</span>
			<span class="k">return</span> <span class="s">&quot;Time (JD): </span><span class="si">%.6f</span><span class="s">, Flux: </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
		<span class="n">LCax2</span><span class="o">.</span><span class="n">format_coord</span> <span class="o">=</span> <span class="n">format_coord</span>
		<span class="c">##############################</span>
		<span class="c"># Plot traces and histograms of mcmc params</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">allparams</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
		<span class="n">ap</span> <span class="o">=</span> <span class="n">allparams</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
		<span class="n">i</span> <span class="o">=</span> <span class="n">allparams</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>
		<span class="n">t0</span> <span class="o">=</span> <span class="n">allparams</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span>
		<span class="n">abscissa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">allparams</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]))</span>   <span class="c">## Make x-axis for trace plots</span>

		<span class="k">def</span> <span class="nf">chainplot</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">format</span><span class="p">,</span><span class="n">burnFraction</span><span class="o">=</span><span class="n">burnFraction</span><span class="p">):</span>
			<span class="c">#yfmt.set_powerlimits((-30,30))</span>
			<span class="c">#fmt2 = FormatStrFormatter(&#39;%.15f&#39;)</span>
			<span class="c">#axis.yaxis.set_major_formatter(fmt2)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">abscissa</span><span class="p">,</span><span class="n">parameter</span><span class="p">,</span><span class="s">&#39;k.&#39;</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">burnFraction</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">abscissa</span><span class="p">),</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="s">&quot; Chain&quot;</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Saved Step Index&#39;</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">get_major_formatter</span><span class="p">()</span><span class="o">.</span><span class="n">set_useOffset</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
			<span class="k">def</span> <span class="nf">format_coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
				<span class="c"># &#39;&#39;&#39;Function to give data value on mouse over plot.&#39;&#39;&#39;</span>
				<span class="k">return</span> <span class="n">format</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">format_coord</span> <span class="o">=</span> <span class="n">format_coord</span> 
			
			<span class="c">#yfmt = axis.yaxis.get_major_formatter()</span>
			<span class="c">#yfmt.set_powerlimits((-50,50))</span>

		<span class="n">chainplot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ax1</span><span class="p">,</span><span class="s">&#39;$R_p / R_s$&#39;</span><span class="p">,</span><span class="s">&#39;Step: </span><span class="si">%i</span><span class="s">,  Rp/Rs: </span><span class="si">%f</span><span class="s">&#39;</span><span class="p">)</span>
		<span class="n">chainplot</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="s">&#39;$a / R_s$&#39;</span><span class="p">,</span><span class="s">&#39;Step: </span><span class="si">%i</span><span class="s">,  a/Rs: </span><span class="si">%f</span><span class="s">&#39;</span><span class="p">)</span>
		<span class="n">chainplot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ax5</span><span class="p">,</span><span class="s">&#39;Inclination&#39;</span><span class="p">,</span><span class="s">&#39;Step: </span><span class="si">%i</span><span class="s">,  Inclination: </span><span class="si">%f</span><span class="s">&#39;</span><span class="p">)</span>
		<span class="n">chainplot</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">ax7</span><span class="p">,</span><span class="s">&#39;Mid-Transit Time&#39;</span><span class="p">,</span><span class="s">&#39;Step: </span><span class="si">%i</span><span class="s">, Mid-Trans Time: </span><span class="si">%.6f</span><span class="s">&#39;</span><span class="p">)</span>


		<span class="k">def</span> <span class="nf">histplot</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">bestFitParameter</span><span class="p">,</span><span class="n">format</span><span class="p">):</span>
			<span class="n">postburn</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="n">burnFraction</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">parameter</span><span class="p">):</span><span class="nb">len</span><span class="p">(</span><span class="n">parameter</span><span class="p">)]</span>	<span class="c">## Burn beginning of chain</span>
			<span class="n">Nbins</span> <span class="o">=</span> <span class="mi">50</span>			  <span class="c">## Plot histograms with 15 bins</span>
			<span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">postburn</span><span class="p">,</span> <span class="n">Nbins</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>  <span class="c">## Generate histogram</span>
			<span class="n">plus</span><span class="p">,</span><span class="n">minus</span> <span class="o">=</span> <span class="n">get_uncertainties</span><span class="p">(</span><span class="n">postburn</span><span class="p">,</span><span class="n">bestFitParameter</span><span class="p">)</span>   <span class="c">## Calculate uncertainties on best fit parameter</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">bestFitParameter</span><span class="o">+</span><span class="n">plus</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>	<span class="c">## Plot vertical lines representing uncertainties</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">bestFitParameter</span><span class="o">-</span><span class="n">minus</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>	   
			<span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">bestFitParameter</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>	   
			<span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Frequency&#39;</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> 
			<span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>		
			<span class="k">def</span> <span class="nf">format_coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
				<span class="c"># &#39;&#39;&#39;Function to give data value on mouse over plot.&#39;&#39;&#39;</span>
				<span class="k">return</span> <span class="n">format</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
			<span class="n">axis</span><span class="o">.</span><span class="n">format_coord</span> <span class="o">=</span> <span class="n">format_coord</span> 
		<span class="c">## Plot the histograms</span>
		<span class="n">histplot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="s">&#39;$R_p / R_s$&#39;</span><span class="p">,</span><span class="n">bestp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&quot;Rp/Rs: </span><span class="si">%f</span><span class="s">,  Freq: </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">histplot</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span><span class="n">ax4</span><span class="p">,</span><span class="s">&#39;$a / R_s$&#39;</span><span class="p">,</span><span class="n">bestp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;a/Rs: </span><span class="si">%f</span><span class="s">,  Freq: </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">histplot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ax6</span><span class="p">,</span><span class="s">&#39;Inclination&#39;</span><span class="p">,</span><span class="n">bestp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s">&quot;Inclination: </span><span class="si">%f</span><span class="s">,  Freq: </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="n">histplot</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">ax8</span><span class="p">,</span><span class="s">&#39;Mid-Transit Time&#39;</span><span class="p">,</span><span class="n">bestp</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="s">&quot;Mid-Trans Time: </span><span class="si">%.6f</span><span class="s">, Freq: </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="c">#fig.subplots_adjust(wspace=0.4,hspace=0.3,bottom=0.1, right=0.95, left=0.05, top=0.95)</span>
		<span class="n">figLC</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="c">#plt.savefig(&quot;mcmc_results.png&quot;,bbox_inches=&#39;tight&#39;)	 ## Save plot</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">OSCAAR 2.0beta documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Brett M. Morris and the OSCAAR Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>